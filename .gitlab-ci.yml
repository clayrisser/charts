image:
  name: codejamninja/make-helm:latest
  entrypoint: ["/bin/sh", "-c"]

stages:
  - lint
  - publish

lint:
  stage: lint
  script:
    - make -s lint

pages:
  stage: publish
  script:
    - |
      JOB_ID=$(curl -L https://${CI_SERVER_URL}/api/v4/projects/${CI_PROJECT_ID}/jobs | \
        jq -r '[.[] | select(.name=="pages")][0].id') && \
        curl -L -o artifacts.zip https://${CI_SERVER_URL}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}/-/jobs/${JOB_ID}/artifacts/download
    - unzip artifacts.zip
    - ls public
    - make -s package
  artifacts:
    paths:
      - public
  only:
    - main
