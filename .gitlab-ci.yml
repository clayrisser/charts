image:
  name: codejamninja/make-helm:latest
  entrypoint: ["/bin/sh", "-c"]

variables:
  HELM_EXPERIMENTAL_OCI: 1

stages:
  - lint
  - release

lint:
  stage: lint
  script:
    - make -s lint

release:
  stage: release
  script:
    - helm registry login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - make -s publish
  only:
    - tags
