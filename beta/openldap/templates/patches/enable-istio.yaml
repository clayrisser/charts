{{- if .Values.config.enableIstio }}
apiVersion: patch.risserlabs.com/v1alpha1
kind: Patch
metadata:
  name: enable-istio
  namespace: {{ .Release.Namespace }}
spec:
  epoch: {{ now | unixEpoch | quote }}
  patches:
    - id: patch-namespace
      target:
        group: core
        version: v1
        kind: Namespace
        name: {{ .Release.Namespace }}
      waitForResource: true
      type: merge
      patch: |-
        metadata:
          labels:
            istio-injection: enabled
{{- end }}
