--- charts/gitlab-operator/templates/operator.yaml	2021-12-24 00:47:11.616223950 -0600
+++ charts/gitlab-operator/templates/operator.yaml.tmp	2021-12-24 00:46:52.127988876 -0600
@@ -2,8 +2,11 @@
 kind: CustomResourceDefinition
 metadata:
   annotations:
-    cert-manager.io/inject-ca-from: gitlab-system/gitlab-serving-cert
+    cert-manager.io/inject-ca-from: {{ .Release.Namespace }}/gitlab-serving-cert
     controller-gen.kubebuilder.io/version: v0.3.0
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
   name: gitlabs.apps.gitlab.com
 spec:
   additionalPrinterColumns:
@@ -124,26 +127,26 @@
 metadata:
   creationTimestamp: null
   name: gitlab-app
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: v1
 kind: ServiceAccount
 metadata:
   creationTimestamp: null
   name: gitlab-manager
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: v1
 kind: ServiceAccount
 metadata:
   name: gitlab-nginx-ingress
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: Role
 metadata:
   name: gitlab-leader-election-role
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 rules:
 - apiGroups:
   - ""
@@ -171,7 +174,7 @@
 kind: Role
 metadata:
   name: gitlab-nginx-ingress
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 rules:
 - apiGroups:
   - ""
@@ -257,6 +260,10 @@
 metadata:
   creationTimestamp: null
   name: gitlab-app-role
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 rules:
 - apiGroups:
   - security.openshift.io
@@ -272,6 +279,10 @@
 metadata:
   creationTimestamp: null
   name: gitlab-manager-role
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 rules:
 - apiGroups:
   - apps
@@ -544,6 +555,10 @@
 kind: ClusterRole
 metadata:
   name: gitlab-proxy-role
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 rules:
 - apiGroups:
   - authentication.k8s.io
@@ -562,6 +577,10 @@
 kind: ClusterRole
 metadata:
   name: gitlab-metrics-reader
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 rules:
 - nonResourceURLs:
   - /metrics
@@ -572,7 +591,7 @@
 kind: RoleBinding
 metadata:
   name: gitlab-leader-election-rolebinding
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: Role
@@ -580,13 +599,13 @@
 subjects:
 - kind: ServiceAccount
   name: gitlab-manager
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: RoleBinding
 metadata:
   name: gitlab-nginx-ingress
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: Role
@@ -594,12 +613,16 @@
 subjects:
 - kind: ServiceAccount
   name: gitlab-nginx-ingress
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRoleBinding
 metadata:
   name: gitlab-gitlab-app-rolebinding
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: ClusterRole
@@ -607,12 +630,16 @@
 subjects:
 - kind: ServiceAccount
   name: gitlab-app
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRoleBinding
 metadata:
   name: gitlab-gitlab-manager-rolebinding
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: ClusterRole
@@ -620,12 +647,16 @@
 subjects:
 - kind: ServiceAccount
   name: gitlab-manager
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRoleBinding
 metadata:
   name: gitlab-gitlab-proxy-rolebinding
+  annotations:
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
 roleRef:
   apiGroup: rbac.authorization.k8s.io
   kind: ClusterRole
@@ -633,7 +664,7 @@
 subjects:
 - kind: ServiceAccount
   name: gitlab-manager
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 ---
 apiVersion: v1
 kind: Service
@@ -641,7 +672,7 @@
   labels:
     control-plane: controller-manager
   name: gitlab-controller-manager-metrics-service
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 spec:
   ports:
   - name: https
@@ -654,7 +685,7 @@
 kind: Service
 metadata:
   name: gitlab-webhook-service
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 spec:
   ports:
   - port: 443
@@ -669,7 +700,7 @@
   labels:
     control-plane: controller-manager
   name: gitlab-controller-manager
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 spec:
   replicas: 1
   selector:
@@ -743,25 +774,25 @@
           defaultMode: 420
           secretName: webhook-server-cert
 ---
-apiVersion: cert-manager.io/v1alpha2
+apiVersion: cert-manager.io/v1
 kind: Certificate
 metadata:
   name: gitlab-serving-cert
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 spec:
   dnsNames:
-  - gitlab-webhook-service.gitlab-system.svc
-  - gitlab-webhook-service.gitlab-system.svc.cluster.local
+  - gitlab-webhook-service.{{ .Release.Namespace }}.svc
+  - gitlab-webhook-service.{{ .Release.Namespace }}.svc.cluster.local
   issuerRef:
     kind: Issuer
     name: gitlab-selfsigned-issuer
   secretName: webhook-server-cert
 ---
-apiVersion: cert-manager.io/v1alpha2
+apiVersion: cert-manager.io/v1
 kind: Issuer
 metadata:
   name: gitlab-selfsigned-issuer
-  namespace: gitlab-system
+  namespace: {{ .Release.Namespace }}
 spec:
   selfSigned: {}
 ---
@@ -769,14 +800,17 @@
 kind: ValidatingWebhookConfiguration
 metadata:
   annotations:
-    cert-manager.io/inject-ca-from: gitlab-system/gitlab-serving-cert
+    cert-manager.io/inject-ca-from: {{ .Release.Namespace }}/gitlab-serving-cert
+    helm.sh/hook: pre-install
+    helm.sh/hook-weight: '0'
+    helm.sh/hook-delete-policy: before-hook-creation
   name: gitlab-gitlab-validating-webhook-configuration
 webhooks:
 - clientConfig:
     caBundle: Cg==
     service:
       name: gitlab-webhook-service
-      namespace: gitlab-system
+      namespace: {{ .Release.Namespace }}
       path: /validate-apps-gitlab-com-v1beta1-gitlab
   failurePolicy: Fail
   name: vgitlab.kb.io
