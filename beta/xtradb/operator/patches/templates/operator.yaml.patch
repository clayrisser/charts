--- templates/operator.yaml	2021-12-26 03:54:28.184398243 -0600
+++ templates/operator.yaml.tmp	2021-12-26 03:54:08.840194654 -0600
@@ -1,3 +1,4 @@
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusters.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
@@ -450,7 +451,9 @@
           specReplicasPath: .spec.pxc.size
           statusReplicasPath: .status.pxc.ready
           labelSelectorPath: .status.pxc.labelSelectorPath
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterbackups.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
@@ -506,7 +509,9 @@
         jsonPath: .metadata.creationTimestamp
       subresources:
         status: {}
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterrestores.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
@@ -554,7 +559,9 @@
         jsonPath: .metadata.creationTimestamp
       subresources:
         status: {}
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbbackups.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
@@ -606,6 +613,7 @@
       - name: Age
         type: date
         jsonPath: .metadata.creationTimestamp
+{{- end }}
 ---
 kind: Role
 apiVersion: rbac.authorization.k8s.io/v1
@@ -748,11 +756,18 @@
       - command:
         - percona-xtradb-cluster-operator
         env:
+{{- if .Values.config.watchNamespace }}
+{{- if (eq .Values.config.watchNamespace true) }}
         - name: WATCH_NAMESPACE
           valueFrom:
             fieldRef:
               apiVersion: v1
               fieldPath: metadata.namespace
+{{- else }}
+        - name: WATCH_NAMESPACE
+          value: {{ .Values.config.watchNamespace | quote }}
+{{- end }}
+{{- end }}
         - name: POD_NAME
           valueFrom:
             fieldRef:
@@ -760,7 +775,7 @@
               fieldPath: metadata.name
         - name: OPERATOR_NAME
           value: percona-xtradb-cluster-operator
-        image: percona/percona-xtradb-cluster-operator:1.10.0
+        image: {{ .Values.images.xtradbOperator.repository }}:{{ .Values.images.xtradbOperator.tag }}
         imagePullPolicy: Always
         livenessProbe:
           failureThreshold: 3
