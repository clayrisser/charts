--- templates/crds.yaml	2022-10-27 08:13:37.152674651 -0500
+++ templates/crds.yaml.tmp	2022-10-27 08:14:31.704908359 -0500
@@ -1,7 +1,11 @@
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusters.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   name: perconaxtradbclusters.pxc.percona.com
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   group: pxc.percona.com
   names:
@@ -450,11 +454,16 @@
           specReplicasPath: .spec.pxc.size
           statusReplicasPath: .status.pxc.ready
           labelSelectorPath: .status.pxc.labelSelectorPath
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterbackups.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   name: perconaxtradbclusterbackups.pxc.percona.com
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   group: pxc.percona.com
   names:
@@ -506,11 +515,16 @@
         jsonPath: .metadata.creationTimestamp
       subresources:
         status: {}
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterrestores.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   name: perconaxtradbclusterrestores.pxc.percona.com
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   group: pxc.percona.com
   names:
@@ -554,11 +568,16 @@
         jsonPath: .metadata.creationTimestamp
       subresources:
         status: {}
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbbackups.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   name: perconaxtradbbackups.pxc.percona.com
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   group: pxc.percona.com
   names:
@@ -606,178 +625,4 @@
       - name: Age
         type: date
         jsonPath: .metadata.creationTimestamp
----
-kind: Role
-apiVersion: rbac.authorization.k8s.io/v1
-metadata:
-  name: percona-xtradb-cluster-operator
-rules:
-- apiGroups:
-  - pxc.percona.com
-  resources:
-  - perconaxtradbclusters
-  - perconaxtradbclusters/status
-  - perconaxtradbclusterbackups
-  - perconaxtradbclusterbackups/status
-  - perconaxtradbclusterrestores
-  - perconaxtradbclusterrestores/status
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-- apiGroups:
-  - ""
-  resources:
-  - pods
-  - pods/exec
-  - pods/log
-  - configmaps
-  - services
-  - persistentvolumeclaims
-  - secrets
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-- apiGroups:
-  - apps
-  resources:
-  - deployments
-  - replicasets
-  - statefulsets
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-- apiGroups:
-  - batch
-  resources:
-  - jobs
-  - cronjobs
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-- apiGroups:
-  - policy
-  resources:
-  - poddisruptionbudgets
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-- apiGroups:
-  - certmanager.k8s.io
-  - cert-manager.io
-  resources:
-  - issuers
-  - certificates
-  verbs:
-  - get
-  - list
-  - watch
-  - create
-  - update
-  - patch
-  - delete
-  - deletecollection
----
-apiVersion: v1
-kind: ServiceAccount
-metadata:
-  name: percona-xtradb-cluster-operator
----
-kind: RoleBinding
-apiVersion: rbac.authorization.k8s.io/v1
-metadata:
-  name: service-account-percona-xtradb-cluster-operator
-subjects:
-- kind: ServiceAccount
-  name: percona-xtradb-cluster-operator
-roleRef:
-  kind: Role
-  name: percona-xtradb-cluster-operator
-  apiGroup: rbac.authorization.k8s.io
----
-apiVersion: apps/v1
-kind: Deployment
-metadata:
-  name: percona-xtradb-cluster-operator
-spec:
-  replicas: 1
-  selector:
-    matchLabels:
-      app.kubernetes.io/component: operator
-      app.kubernetes.io/instance: percona-xtradb-cluster-operator
-      app.kubernetes.io/name: percona-xtradb-cluster-operator
-      app.kubernetes.io/part-of: percona-xtradb-cluster-operator
-  strategy:
-    rollingUpdate:
-      maxUnavailable: 1
-    type: RollingUpdate
-  template:
-    metadata:
-      labels:
-        app.kubernetes.io/component: operator
-        app.kubernetes.io/instance: percona-xtradb-cluster-operator
-        app.kubernetes.io/name: percona-xtradb-cluster-operator
-        app.kubernetes.io/part-of: percona-xtradb-cluster-operator
-    spec:
-      terminationGracePeriodSeconds: 600
-      containers:
-      - command:
-        - percona-xtradb-cluster-operator
-        env:
-        - name: WATCH_NAMESPACE
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.namespace
-        - name: POD_NAME
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.name
-        - name: OPERATOR_NAME
-          value: percona-xtradb-cluster-operator
-        image: percona/percona-xtradb-cluster-operator:1.10.0
-        imagePullPolicy: Always
-        livenessProbe:
-          failureThreshold: 3
-          httpGet:
-            path: /metrics
-            port: metrics
-            scheme: HTTP
-        resources:
-          limits:
-            cpu: 200m
-            memory: 500Mi
-          requests:
-            cpu: 100m
-            memory: 20Mi
-        name: percona-xtradb-cluster-operator
-        ports:
-        - containerPort: 8080
-          name: metrics
-          protocol: TCP
-      serviceAccountName: percona-xtradb-cluster-operator
+{{- end }}
