--- templates/operator.yaml	2022-10-28 08:05:09.450803265 -0500
+++ templates/operator.yaml.tmp	2022-10-28 08:15:22.676570902 -0500
@@ -1,7 +1,11 @@
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusters.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   name: perconaxtradbclusters.pxc.percona.com
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   group: pxc.percona.com
   names:
@@ -8541,12 +8545,16 @@
       storage: true
       subresources:
         status: {}
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterbackups.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   annotations:
     controller-gen.kubebuilder.io/version: v0.8.0
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
   creationTimestamp: null
   name: perconaxtradbclusterbackups.pxc.percona.com
 spec:
@@ -8643,12 +8651,16 @@
     plural: ""
   conditions: []
   storedVersions: []
+{{- end }}
 ---
+{{- if (not (lookup "apiextensions.k8s.io/v1" "CustomResourceDefinition" "" "perconaxtradbclusterrestores.pxc.percona.com")) }}
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
   annotations:
     controller-gen.kubebuilder.io/version: v0.8.0
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
   creationTimestamp: null
   name: perconaxtradbclusterrestores.pxc.percona.com
 spec:
@@ -8781,11 +8793,16 @@
     plural: ""
   conditions: []
   storedVersions: []
+{{- end }}
 ---
+{{- if (not (lookup "rbac.authorization.k8s.io/v1" "ClusterRole" "" "percona-xtradb-cluster-operator")) }}
 kind: ClusterRole
 apiVersion: rbac.authorization.k8s.io/v1
 metadata:
   name: percona-xtradb-cluster-operator
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 rules:
 - apiGroups:
   - pxc.percona.com
@@ -8907,16 +8924,27 @@
   - patch
   - delete
   - deletecollection
+{{- end }}
 ---
+{{- if (not (lookup "v1" "ServiceAccount" "pxc-operator" "percona-xtradb-cluster-operator")) }}
 apiVersion: v1
 kind: ServiceAccount
 metadata:
   name: percona-xtradb-cluster-operator
+  namespace: pxc-operator
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
+{{- end }}
 ---
+{{- if (not (lookup "rbac.authorization.k8s.io/v1" "ClusterRoleBinding" "" "service-account-percona-xtradb-cluster-operator")) }}
 kind: ClusterRoleBinding
 apiVersion: rbac.authorization.k8s.io/v1
 metadata:
   name: service-account-percona-xtradb-cluster-operator
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 subjects:
 - kind: ServiceAccount
   name: percona-xtradb-cluster-operator
@@ -8925,11 +8953,17 @@
   kind: ClusterRole
   name: percona-xtradb-cluster-operator
   apiGroup: rbac.authorization.k8s.io
+{{- end }}
 ---
+{{- if (not (lookup "apps/v1" "Deployment" "pxc-operator" "percona-xtradb-cluster-operator")) }}
 apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: percona-xtradb-cluster-operator
+  namespace: pxc-operator
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   replicas: 1
   selector:
@@ -8985,16 +9019,23 @@
           name: metrics
           protocol: TCP
       serviceAccountName: percona-xtradb-cluster-operator
+{{- end }}
 ---
+{{- if (not (lookup "v1" "Service" "pxc-operator" "percona-xtradb-cluster-operator")) }}
 apiVersion: v1
 kind: Service
 metadata:
   name: percona-xtradb-cluster-operator
+  namespace: pxc-operator
   labels:
     name: percona-xtradb-cluster-operator
+  annotations:
+    helm.sh/hook: pre-install,pre-upgrade
+    helm.sh/hook-weight: '5'
 spec:
   ports:
     - port: 443
       targetPort: 9443
   selector:
     app.kubernetes.io/name: percona-xtradb-cluster-operator
+{{- end }}
