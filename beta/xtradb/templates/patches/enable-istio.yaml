{{- if .Values.config.istio }}
apiVersion: patch.rock8s.com/v1alpha1
kind: Patch
metadata:
  name: enable-istio
spec:
  epoch: {{ now | unixEpoch | quote }}
  patches:
    - id: patch-namespace
      target:
        apiVersion: v1
        kind: Namespace
        name: {{ .Release.Namespace }}
      waitForResource: true
      type: merge
      patch: |
        metadata:
          labels:
            istio-injection: enabled
{{- end }}
