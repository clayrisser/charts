apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "openldap.fullname" . }}-openldap
  labels:
    app: {{ template "openldap.name" . }}-openldap
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
  01-organization.ldif: |
    version: 1

    dn: {{ template "openldap.openldap-dc" . }}
    objectClass: top
    objectClass: dcObject
    objectClass: organization
    o: {{ .Values.config.organization }}
    dc: {{ index (regexSplit "\\." .Values.config.domain -1) 0 }}
  02-ppolicy.ldif: |
    dn: cn=module{0},cn=config
    changetype: add
    add: olcModuleLoad
    olcModuleLoad: ppolicy

    dn: olcOverlay=ppolicy,olcDatabase={1}mdb,cn=config
    changetype: add
    objectClass: olcPPolicyConfig
    objectClass: olcOverlayConfig
    olcOverlay: ppolicyolcPPolicy
    Default: cn=normalPolicy,ou=Policies,dc=aipadmin,dc=comolcPPolicy
    HashCleartext: TRUE
    olcPPolicyUseLockout: TRUE
